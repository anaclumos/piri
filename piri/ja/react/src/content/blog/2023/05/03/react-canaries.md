---
title: React カナリア: Meta外での段階的な機能展開の有効化
author: Dan Abramov, Sophie Alpert, Rick Hanlon, Sebastian Markbage, and Andrew Clark
date: 2023/05/03
description: 私たちは、React コミュニティに対して、設計が最終段階に近づいた新機能を安定版としてリリースされる前に個別に採用するオプションを提供したいと考えています。これは、Meta が長い間 React の最先端バージョンを内部で使用してきた方法に似ています。新しく公式にサポートされる [Canary リリースチャンネル](/community/versioning-policy#canary-channel) を導入します。これにより、フレームワークのようなキュレーションされたセットアップが、React のリリーススケジュールから個別の React 機能の採用を切り離すことができます。
---

2023年5月3日 [Dan Abramov](https://twitter.com/dan_abramov)、[Sophie Alpert](https://twitter.com/sophiebits)、[Rick Hanlon](https://twitter.com/rickhanlonii)、[Sebastian Markbåge](https://twitter.com/sebmarkbage)、および [Andrew Clark](https://twitter.com/acdlite) による

---

<Intro>

Reactコミュニティに対して、Metaが長年内部で使用してきた最先端のReactバージョンと同様に、安定版がリリースされる前に設計がほぼ確定した新機能を個別に採用するオプションを提供したいと考えています。新しい公式サポートの[Canaryリリースチャンネル](/community/versioning-policy#canary-channel)を導入します。これにより、フレームワークのようなキュレーションされたセットアップが、Reactのリリーススケジュールから個別のReact機能の採用を切り離すことができます。

</Intro>

---

## 要約 {/*tldr*/}

* Reactの公式サポートの[Canaryリリースチャンネル](/community/versioning-policy#canary-channel)を導入します。公式サポートされているため、リグレッションが発生した場合、安定版リリースのバグと同様の緊急性で対処します。
* Canaryを使用すると、semver安定リリースに到達する前に個別の新しいReact機能を使用し始めることができます。
* [Experimental](/community/versioning-policy#experimental-channel)チャンネルとは異なり、React Canariesには採用準備が整っていると合理的に考えられる機能のみが含まれます。フレームワークが固定されたCanary Reactリリースをバンドルすることを検討することをお勧めします。
* Canaryリリースに含まれる破壊的変更や新機能については、ブログで発表します。
* **いつものように、Reactはすべての安定リリースでsemverに従います。**

## React機能の通常の開発プロセス {/*how-react-features-are-usually-developed*/}

通常、すべてのReact機能は同じ段階を経て開発されます：

1. 初期バージョンを開発し、`experimental_`または`unstable_`というプレフィックスを付けます。この機能は`experimental`リリースチャンネルでのみ利用可能です。この時点では、機能は大幅に変更されることが予想されます。
2. Meta内でこの機能をテストし、フィードバックを提供してくれるチームを見つけます。これにより、変更のラウンドが行われます。機能がより安定するにつれて、Meta内の他のチームと協力して試してみます。
3. 最終的に設計に自信を持ちます。API名からプレフィックスを削除し、Metaのほとんどの製品が使用する`main`ブランチでデフォルトで利用可能にします。この時点で、Metaのどのチームでもこの機能を使用できます。
4. 方向性に自信を持つと、RFCを投稿します。この時点で、設計が広範なケースに対して機能することがわかっていますが、最後の調整を行うことがあります。
5. オープンソースリリースに近づくと、機能のドキュメントを作成し、最終的に安定したReactリリースで機能をリリースします。

このプレイブックは、これまでにリリースされたほとんどの機能に対してうまく機能しています。しかし、機能が一般的に使用可能になる時点（ステップ3）とオープンソースでリリースされる時点（ステップ5）の間には大きなギャップがあることがあります。

**Reactコミュニティに対して、Metaと同じアプローチを採用し、次のReactリリースサイクルを待たずに個別の新機能を早期に採用するオプションを提供したいと考えています。**

いつものように、すべてのReact機能は最終的に安定リリースに含まれます。

## より多くのマイナーリリースを行うことはできないのか？ {/*can-we-just-do-more-minor-releases*/}

一般的に、新機能を導入するためにマイナーリリースを使用します。

しかし、これは常に可能ではありません。新機能がまだ完全に完成していない他の新機能と相互に関連している場合があります。これらを別々にリリースすることはできません。なぜなら、それらの実装が関連しているからです。別々にバージョン管理することもできません。なぜなら、それらが同じパッケージ（例えば、`react`と`react-dom`）に影響を与えるからです。また、semverが要求するように、準備が整っていない部分を頻繁にメジャーバージョンリリースすることなく、反復する能力を維持する必要があります。

Metaでは、`main`ブランチからReactをビルドし、毎週特定の固定コミットに手動で更新することでこの問題を解決しています。これは、React Nativeリリースが過去数年間にわたって採用してきたアプローチでもあります。React Nativeのすべての*安定*リリースは、Reactリポジトリの`main`ブランチからの特定のコミットに固定されています。これにより、React Nativeは重要なバグ修正を含め、フレームワークレベルで新しいReact機能を段階的に採用することができ、グローバルなReactリリーススケジュールに結びつけられることはありません。

このワークフローを他のフレームワークやキュレーションされたセットアップに提供したいと考えています。例えば、Reactの上にあるフレームワークが、Reactの安定リリースに含まれる前にReact関連の破壊的変更を含めることができます。これは特に、破壊的変更がフレームワークの統合にのみ影響を与える場合に有用です。これにより、フレームワークはsemverを破ることなく、自身のマイナーバージョンでそのような変更をリリースすることができます。

Canariesチャンネルを使用したローリングリリースにより、フィードバックループを緊密にし、新機能がコミュニティで包括的にテストされることを保証します。このワークフローは、TC39（JavaScript標準委員会）が[番号付きステージで変更を処理する](https://tc39.es/process-document/)方法に近いです。新しいReact機能は、Reactの安定リリースに含まれる前に、Reactを基盤とするフレームワークで利用可能になる場合があります。これは、新しいJavaScript機能が公式に仕様の一部として承認される前にブラウザで出荷されるのと同様です。

## なぜ実験的リリースを使用しないのか？ {/*why-not-use-experimental-releases-instead*/}

技術的には[実験的リリース](/community/versioning-policy#canary-channel)を使用することができますが、実験的APIは安定化に向けて大幅な破壊的変更を受ける可能性があるため、プロダクションでの使用はお勧めしません（または完全に削除されることもあります）。Canariesにもミスが含まれる可能性がありますが（どのリリースにも同様に）、今後はCanariesに含まれる重要な破壊的変更についてブログで発表する予定です。CanariesはMetaが内部で実行しているコードに最も近いため、一般的に比較的安定していると期待できます。ただし、バージョンを固定し、固定コミット間の更新時にGitHubのコミットログを手動でスキャンする必要があります。

**キュレーションされたセットアップ（フレームワークなど）を使用していないほとんどの人は、引き続き安定リリースを使用することをお勧めします。** ただし、フレームワークを構築している場合は、特定のコミットに固定されたCanaryバージョンのReactをバンドルし、自分のペースで更新することを検討するかもしれません。その利点は、React Nativeが過去数年間に行ってきたように、個別に完成したReact機能やバグ修正をユーザーに早期に提供し、自分のリリーススケジュールで提供できることです。その欠点は、取り込まれるReactコミットをレビューし、リリースに含まれるReactの変更をユーザーに伝える追加の責任を負うことです。

フレームワークの作者であり、このアプローチを試してみたい場合は、ぜひご連絡ください。

## 破壊的変更と新機能の早期発表 {/*announcing-breaking-changes-and-new-features-early*/}

Canaryリリースは、任意の時点で次の安定Reactリリースに含まれると予想されるものを最良の推測で表します。

従来、破壊的変更はリリースサイクルの*終わり*（メジャーリリース時）にのみ発表していました。CanaryリリースがReactを消費する公式サポートの方法となった今、破壊的変更や重要な新機能をCanariesに含まれる*とき*に発表する方向にシフトする予定です。例えば、Canaryに含まれる破壊的変更をマージした場合、その変更についてReactブログに投稿し、必要に応じてコードモッドや移行手順を含めます。次に、固定されたReact Canaryを含むメジャーリリースを行うフレームワークの作者であれば、そのリリースノートから私たちのブログ投稿にリンクすることができます。最終的に、安定したメジャーバージョンのReactが準備できたときには、すでに公開されたブログ投稿にリンクし、チームがより迅速に進捗を進めるのに役立つことを期待しています。

Canariesに含まれるAPIが利用可能になると、それらのAPIをドキュメント化する予定です。これらのAPIはCanaries以外ではまだ利用できない場合があります。Canariesでのみ利用可能なAPIには、対応するページに特別な注釈が付けられます。これには、[`use`](https://github.com/reactjs/rfcs/pull/229)や、いくつかの他のAPI（`cache`や`createServerContext`など）が含まれ、これらについてもRFCを送信する予定です。

## Canariesは固定する必要があります {/*canaries-must-be-pinned*/}

アプリやフレームワークでCanaryワークフローを採用する場合、使用しているCanaryの*正確な*バージョンを常に固定するようにしてください。Canariesはプレリリースであるため、破壊的変更が含まれる可能性があります。

## 例：React Server Components {/*example-react-server-components*/}

[3月に発表したように](/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components)、React Server Componentsの規約は確定しており、ユーザー向けAPI契約に関連する大きな破壊的変更は予想していません。しかし、React Server Componentsのサポートを安定版のReactでリリースすることはまだできません。なぜなら、いくつかの相互に関連するフレームワーク専用の機能（例えば、[アセットローディング](/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#asset-loading)）に取り組んでおり、そこにさらなる破壊的変更が予想されるからです。

これは、React Server Componentsがフレームワークによって採用される準備ができていることを意味します。しかし、次のメジャーReactリリースまで、フレームワークがそれらを採用する唯一の方法は、固定されたCanaryバージョンのReactを出荷することです。（Reactの2つのコピーをバンドルしないようにするために、これを行いたいフレームワークは、`react`と`react-dom`の解決を固定されたCanaryに強制し、ユーザーにそれを説明する必要があります。例として、Next.js App Routerがこれを行っています。）

## 安定版とCanary版の両方でライブラリをテストする {/*testing-libraries-against-both-stable-and-canary-versions*/}

すべてのCanaryリリースをテストすることは非常に困難であるため、ライブラリの作者がそれを行うことを期待していません。しかし、[3年前に異なるReactプレリリースチャンネルを導入したとき](https://legacy.reactjs.org/blog/2019/10/22/react-release-channels.html)と同様に、ライブラリが最新の安定版と最新のCanary版の両方でテストを実行することを奨励します。発表されていない動作の変化が見られた場合は、Reactリポジトリにバグを報告してください。これが広く採用されると、Reactの新しいメジャーバージョンにライブラリをアップグレードするための労力が減少し、偶発的なリグレッションが発生した時点で発見されることを期待しています。

<Note>

厳密に言えば、Canaryは*新しい*リリースチャンネルではありません。以前はNextと呼ばれていました。しかし、Next.jsとの混乱を避けるために名前を変更することにしました。新しい期待を伝えるために、Canaryを*新しい*リリースチャンネルとして発表しています。例えば、CanariesがReactを使用する公式サポートの方法であることなどです。

</Note>

## 安定リリースは以前と同じように機能します {/*stable-releases-work-like-before*/}

安定したReactリリースには変更を加えていません。